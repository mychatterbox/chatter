<script is:inline>
  (function() {
    // 1. 전역 변수 안전 초기화
    window.__themeColors = window.__themeColors || {
      light: "#f5f7f9", // theme.ts와 동일한 값
      dark: "#121212"
    };

    // 2. 메타 태그 선택
    const meta = document.querySelector('meta[name="theme-color"]');
    if (!meta) return;

    // 3. 테마 적용 함수
    const applyTheme = (isDark) => {
      document.documentElement.classList.toggle("dark", isDark);
      localStorage.setItem("theme", isDark ? "dark" : "light");
      meta.content = isDark ? window.__themeColors.dark : window.__themeColors.light;
    };

    // 4. 초기 테마 설정
    const initTheme = () => {
      const savedTheme = localStorage.getItem("theme");
      return savedTheme ? savedTheme === "dark" : window.matchMedia("(prefers-color-scheme: dark)").matches;
    };

    // 5. 전역 함수 등록 (토글용)
    window.toggleTheme = () => {
      const isDark = !document.documentElement.classList.contains("dark");
      applyTheme(isDark);
      return isDark ? "dark" : "light";
    };

    // 6. 실행
    applyTheme(initTheme());

    // 7. 시스템 테마 변경 감지
    window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", (e) => {
      if (!localStorage.getItem("theme")) applyTheme(e.matches);
    });

    // 8. Astro 뷰 전환 감지
    document.addEventListener("astro:after-swap", () => applyTheme(initTheme()));
  })();
</script>