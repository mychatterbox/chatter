---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import FeedItem from "components/feed-item.astro";
import Html from "components/html.astro";
import Nav from "components/navbar.astro";

export async function getStaticPaths() {
  const blogPosts = await getCollection("blog");
  
  let draftPosts: CollectionEntry<"draft">[] = [];
  if (import.meta.env.DEV) {
    try {
      draftPosts = await getCollection("draft");
    } catch (error) {
      console.warn("Draft collection is empty or does not exist");
    }
  }
  
  const allPosts = [...blogPosts, ...draftPosts];
  const kinds = new Set(allPosts.map((entry) => entry.data.kind));
  
  return Array.from(kinds).map((kind) => ({ params: { kind } }));
}

const blogPosts = await getCollection("blog");

let draftPosts: CollectionEntry<"draft">[] = [];
if (import.meta.env.DEV) {
  try {
    draftPosts = await getCollection("draft");
  } catch (error) {
    console.warn("Draft collection is empty or does not exist");
  }
}

const allPosts = [...blogPosts, ...draftPosts];
const filteredPosts = allPosts.filter((p) => p.data.kind === Astro.params.kind);
filteredPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<Html title="mychatterbox" description="이런 것도 팁이 되나 싶은 정보들">
  <Nav />
  <main class="main-container">
    <ul class="feed-list article-container">
      {filteredPosts.map((entry) => <FeedItem entry={entry} />)}
    </ul>
  </main>    
</Html>