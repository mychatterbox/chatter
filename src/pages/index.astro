---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import FeedItem from "components/content/feed-item.astro";
import Html from "components/layout/html.astro";
import Nav from "components/layout/navbar.astro";
import Pagination from "components/features/Pagination.astro";
import { PAGE_SIZE } from "config/pagination";

const blogPosts = await getCollection("blog");

let draftPosts: CollectionEntry<"draft">[] = [];
if (import.meta.env.DEV) {
  try {
    draftPosts = await getCollection("draft");
  } catch {
    console.warn("Draft collection is empty or does not exist");
  }
}

const allPosts = [...blogPosts, ...draftPosts];
allPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());

const totalPages = Math.ceil(allPosts.length / PAGE_SIZE);
const posts = allPosts.slice(0, PAGE_SIZE);
---

<Html title="mychatterbox" description="이런 것도 팁이 되나 싶은 정보들">
  <Nav />

  <main class="main-container">
  <h1 class="visually-hidden">mychatterbox 글 목록</h1>
  <div class="landing-content">
    <ul class="feed-list">
      {posts.map((entry) => (<FeedItem entry={entry} />))}
    </ul>
    
    <Pagination 
      currentPage={1}
      totalPages={totalPages}
      baseUrl="/"
    />
  </div>
  </main>
</Html>