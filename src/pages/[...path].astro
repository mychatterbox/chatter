---
import { getCollection } from "astro:content";
import Html from "components/html.astro";
import Nav from "components/navbar.astro";
import Prose from "components/prose.astro";
import { format } from "date-fns";
import { render } from "astro:content";

export async function getStaticPaths() {
  const pub = await getCollection("blog");
  return pub.map((entry) => ({
    params: { path: entry.id },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const {
  data: { title, description, pubDate, kind, ogImage, tags },
} = entry;
const { Content } = await render(entry);

const draft = entry.id.startsWith("draft/");
---

<Html
  title={title}
  description={description}
  pubDate={pubDate}
  ogImage={ogImage}
  ogType="article"
  robots={draft ? "noindex" : undefined}
>
  <Nav />
  <main class="main-container">
    <article class="article-container">
      <div class="article-header">
        <h1 
          transition:name={`title-${entry.id}`}
          class="title-xl"
        >
          {title}
        </h1>  
        <div class="article-meta">
          <div class="text-sm text-muted">
            {
              kind === "article" ? (
                <a href={`/kind/${kind}`} class="link-blue pr-2">
                  Article
                </a>
              ) : kind === "note" ? (
                <a href={`/kind/${kind}`} class="link-emerald pr-2">
                  Note
                </a>
              ) : null
            } {format(pubDate, "y-MM-dd")}
          </div>
          {
            draft && (
              <div class="text-sm font-black uppercase text-rose">draft</div>
            )
          }
        </div>
      </div>
      <Prose>
        <Content />
    </Prose>
      
      <!-- 태그 섹션 -->
      {tags && tags.length > 0 && (
        <div class="tags-container">
          <div class="tags-wrapper">
            {tags.map((tag: string) => (
              <a
                href={`/tag/${tag}`}
                class="link-tag"
              >
                <span class="tag-hash">#</span>{tag}
              </a>
            ))}
          </div>
        </div>
      )}
    </article>
  </main>
</Html>